(()=>{let e=document.body.clientWidth>420?420:document.body.clientWidth,t=document.body.clientHeight>812?812:document.body.clientHeight;const s=window.devicePixelRatio;class i extends Phaser.Scene{constructor(){super({key:"InitScene"})}startBtn=null;preload(){this.load.image("initBG","assets/imgs/startBG.png"),this.load.image("startBtn","assets/imgs/start_btn.png")}create(){this.add.image(e/2,t/2,"initBG").setScale(e/320,t/568),this.startBtn=this.add.sprite(e/2,t/2+140,"startBtn").setInteractive().setScale(.5),this.startBtn.on("pointerup",(function(){n.scene.start("GameScene"),n.scene.sleep("InitScene")}))}update(){}}class l extends Phaser.Scene{constructor(){super({key:"GameScene"})}player=null;bg=null;cursors=null;myBullets=null;enemyPlanes1=null;enemyPlanes2=null;enemyPlanes3=null;enemyTimer=null;productionLineRunTimer=null;supplys1=null;supplys2=null;scoreText=null;myBulletQuantityTimer=[];sounds={do:null,bulletQuantity:null,bigboom:null,bgm:null,gameover:null};initData(){this.x=e/2,this.y=t-200,this.speed=.4,this.isGameOver=!1,this.myBulletQuantity=1,this.score=0,this.scoreText?.setText("Score: "+this.score),this.draw=!1,this.input.on("pointermove",(e=>{this.draw&&(this.player.x=this.x+e.x-e.downX,this.player.y=this.y+e.y-e.downY)})),this.myBulletQuantityTimer.forEach((e=>clearTimeout(e))),this.sounds.bgm.play()}preload(){this.load.image("gameBG","assets/imgs/gameBG.png"),this.load.image("myBullet","assets/imgs/bomb.png"),this.load.image("bulletSupply","assets/imgs/bullet_supply.png"),this.load.image("bombSupply","assets/imgs/bomb_supply.png"),this.load.spritesheet("myPlane","assets/imgs/myPlane.png",{frameWidth:66,frameHeight:82}),this.load.spritesheet("smallPlane","assets/imgs/smallPlane.png",{frameWidth:34,frameHeight:24}),this.load.spritesheet("midPlane","assets/imgs/midPlane.png",{frameWidth:46,frameHeight:64}),this.load.spritesheet("bigPlane","assets/imgs/bigPlane.png",{frameWidth:110,frameHeight:170}),this.load.image("startBtn","assets/imgs/start_btn.png"),this.load.audio("do","assets/audio/ndo.mp3"),this.load.audio("bulletQuantity","assets/audio/chi.mp3"),this.load.audio("bigboom","assets/audio/bigboom.mp3"),this.load.audio("gameover","assets/audio/gameover.mp3"),this.load.audio("bgm","assets/audio/bgm.mp3")}create(){this.sounds.do=this.sound.add("do"),this.sounds.bulletQuantity=this.sound.add("bulletQuantity",{volume:.6}),this.sounds.bigboom=this.sound.add("bigboom"),this.sounds.gameover=this.sound.add("gameover"),this.sounds.bgm=this.sound.add("bgm",{loop:!0}),this.initData(),this.bg=this.add.tileSprite(e/2,t/2,e,t,"gameBG"),this.player=this.physics.add.sprite(this.x,this.y,"myPlane").setInteractive(),this.player.setCollideWorldBounds(!0),this.player.body.setGravityY(0),this.anims.create({key:"myPlaneRun",frames:this.anims.generateFrameNumbers("myPlane",{start:0,end:1}),frameRate:8,repeat:-1}),this.anims.create({key:"myPlaneBoom",frames:this.anims.generateFrameNumbers("myPlane",{start:2,end:5}),frameRate:8}),this.anims.create({key:"smallPlaneRun",frames:[{key:"smallPlane",frame:0}],frameRate:8}),this.anims.create({key:"smallPlaneBoom",frames:this.anims.generateFrameNumbers("smallPlane",{start:1,end:4}),frameRate:32}),this.anims.create({key:"midPlaneRun",frames:[{key:"midPlane",frame:0}],frameRate:8}),this.anims.create({key:"midPlaneAida",frames:[{key:"midPlane",frame:1}],frameRate:8}),this.anims.create({key:"midPlaneBoom",frames:this.anims.generateFrameNumbers("midPlane",{start:2,end:5}),frameRate:32}),this.anims.create({key:"bigPlaneRun",frames:[{key:"bigPlane",frame:0}],frameRate:8}),this.anims.create({key:"bigPlaneAida",frames:[{key:"bigPlane",frame:1}],frameRate:8}),this.anims.create({key:"bigPlaneBoom",frames:this.anims.generateFrameNumbers("bigPlane",{start:2,end:7}),frameRate:38}),this.cursors=this.input.keyboard.createCursorKeys(),this.player.on("pointerdown",(()=>{this.draw=!0,this.x=this.player.x,this.y=this.player.y})),this.input.on("pointerup",(()=>{this.draw=!1})),this.myBullets=this.physics.add.group(),this.time.addEvent({delay:260,loop:!0,callback:()=>{!this.isGameOver&&this.createMyBullet()}}),this.enemyPlanes1=this.physics.add.group(),this.enemyPlanes2=this.physics.add.group(),this.enemyPlanes3=this.physics.add.group(),this.productionLineRun(),this.supplys1=this.physics.add.group(),this.supplys2=this.physics.add.group(),this.physics.add.overlap(this.myBullets,this.enemyPlanes1,this.enemyAndMyBulletCollision,null,this),this.physics.add.overlap(this.myBullets,this.enemyPlanes2,this.enemyAndMyBulletCollision,null,this),this.physics.add.overlap(this.myBullets,this.enemyPlanes3,this.enemyAndMyBulletCollision,null,this),this.physics.add.overlap(this.player,this.enemyPlanes1,this.enemyAndMyPlaneCollision,null,this),this.physics.add.overlap(this.player,this.enemyPlanes2,this.enemyAndMyPlaneCollision,null,this),this.physics.add.overlap(this.player,this.enemyPlanes3,this.enemyAndMyPlaneCollision,null,this),this.physics.add.overlap(this.player,this.supplys1,this.supplyAndMyPlaneCollision,null,this),this.physics.add.overlap(this.player,this.supplys2,this.supplyAndMyPlaneCollision,null,this),this.scoreText=this.add.text(16,16,"score: 0",{fontSize:"28px",fill:"#000"}),this.scoreText.depth=99}update(){this.isGameOver?this.player.anims.play("myPlaneBoom",!0):(this.bg.tilePositionY-=this.speed,this.player.anims.play("myPlaneRun",!0),this.cursors.left.isDown?this.player.setVelocityX(-260):this.cursors.right.isDown?this.player.setVelocityX(260):this.player.setVelocityX(0),this.cursors.up.isDown?this.player.setVelocityY(-260):this.cursors.down.isDown?this.player.setVelocityY(260):this.player.setVelocityY(0),this.myBullets.getChildren().forEach((e=>{e.active&&e.y<-e.height&&this.myBullets.killAndHide(e)})),this.enemyPlanes1.getChildren().forEach((e=>{e.active&&e.y>t+e.height&&this.enemyPlanes1.killAndHide(e)})),this.enemyPlanes2.getChildren().forEach((e=>{e.active&&e.y>t+e.height&&this.enemyPlanes2.killAndHide(e)})),this.enemyPlanes3.getChildren().forEach((e=>{e.active&&e.y>t+e.height&&this.enemyPlanes3.killAndHide(e)})),this.supplys1.getChildren().forEach((e=>{e.active&&e.y>t+e.height&&this.supplys1.killAndHide(e)})),this.supplys2.getChildren().forEach((e=>{e.active&&e.y>t+e.height&&this.supplys2.killAndHide(e)})))}createMyBullet(){for(let e=0;e<this.myBulletQuantity;e++){let t=e<this.myBulletQuantity/2?this.myBulletQuantity%2!=0&&e>this.myBulletQuantity/2-1?this.player.x:this.player.x-20*(this.myBulletQuantity-e-this.myBulletQuantity/2-(this.myBulletQuantity%2!=0?.5:0)):this.player.x+20*(e-this.myBulletQuantity/2+(this.myBulletQuantity%2!=0?.5:1));const s=this.myBullets.get(t,this.player.y-this.player.height/2+10,"myBullet");s.name="myBullet",s.setVelocity(0,-500),s.setScale(.6,1),s.setActive(!0),s.setVisible(!0),this.sounds.do.play()}}productionLineRun(){this.productionLineRunTimer=this.time.addEvent({delay:2e3,loop:!0,callback:()=>{this.speed=this.speed>=1.8?1.8:this.speed+.05,this.enemyTimer?.destroy(),this.enemyTimer=this.time.addEvent({delay:700-280*this.speed,loop:!0,callback:()=>{let e=Math.floor(8*Math.random());e<4?this.createEnemySmallPlane():e>=4&&e<7?this.createEnemyMidPlane():this.createEnemyBigPlane()}});const e=Math.ceil(6*Math.random());e<4?this.createSupply("bulletSupply"):e<6&&this.createSupply("bombSupply")}})}createEnemySmallPlane(){let t=17+Math.ceil(Math.random()*(e-34));const s=this.enemyPlanes1.get(t,-12,"smallPlane");s.name="smallPlane",s.hp=1,s.setVelocity(0,this.speed/4*10*60),s.setActive(!0),s.setVisible(!0),s.anims.play("smallPlaneRun")}createEnemyMidPlane(){let t=23+Math.ceil(Math.random()*(e-46));const s=this.enemyPlanes2.get(t,-32,"midPlane");s.name="midPlane",s.hp=3,s.setVelocity(0,this.speed/4*10*60),s.setActive(!0),s.setVisible(!0),s.anims.play("midPlaneRun")}createEnemyBigPlane(){let t=55+Math.ceil(Math.random()*(e-110));const s=this.enemyPlanes3.get(t,-85,"bigPlane");s.name="bigPlane",s.hp=5,s.setVelocity(0,this.speed/4*10*60),s.setActive(!0),s.setVisible(!0),s.anims.play("bigPlaneRun")}createSupply(t){let s=30+Math.ceil(Math.random()*(e-60)),i=null;"bulletSupply"==t?i=this.supplys1.get(s,-55,t):"bombSupply"==t&&(i=this.supplys2.get(s,-55,t)),i.name=t,i.setVelocity(0,60),i.setActive(!0),i.setVisible(!0)}enemyAndMyBulletCollision(e,t){if(e.active&&t.active){let s=[],i=null;switch(t.name){case"midPlane":s=["midPlaneAida","midPlaneBoom"],i=this.enemyPlanes2;break;case"bigPlane":s=["bigPlaneAida","bigPlaneBoom"],i=this.enemyPlanes3;break;case"smallPlane":s=["","smallPlaneBoom"],i=this.enemyPlanes1}t.hp-=1,t.hp>0&&t.anims.play(s[0]),0==t.hp&&(t.anims.play(s[1]),t.setVelocity(0,0),setTimeout((()=>{i.killAndHide(t)}),180),this.score+=10,this.scoreText.setText("Score: "+this.score)),t.hp>=0&&this.myBullets.killAndHide(e)}}enemyAndMyPlaneCollision(s,i){if(i.hp>0&&i.active){this.sounds.bgm.stop(),this.sounds.gameover.play(),this.isGameOver=!0,this.productionLineRunTimer.destroy(),this.enemyTimer?.destroy(),this.physics.pause(),this.input.off("pointermove");let s=this.add.sprite(e/2,t/2,"startBtn").setInteractive().setScale(.5);s.on("pointerup",(()=>{s.destroy(),this.initData(),this.myBullets.getChildren().forEach((e=>{this.myBullets.killAndHide(e)})),this.enemyPlanes1.getChildren().forEach((e=>{this.enemyPlanes1.killAndHide(e)})),this.enemyPlanes2.getChildren().forEach((e=>{this.enemyPlanes2.killAndHide(e)})),this.enemyPlanes3.getChildren().forEach((e=>{this.enemyPlanes3.killAndHide(e)})),this.supplys1.getChildren().forEach((e=>{this.supplys1.killAndHide(e)})),this.supplys2.getChildren().forEach((e=>{this.supplys2.killAndHide(e)})),this.player.x=this.x,this.player.y=this.y,this.productionLineRun(),this.physics.resume()}))}}supplyAndMyPlaneCollision(e,t){if(t.active)if("bulletSupply"==t.name){if(this.myBulletQuantity<9){this.myBulletQuantity++;let e=setTimeout((()=>{this.myBulletQuantity--,this.myBulletQuantityTimer.splice(this.myBulletQuantityTimer.indexOf(e),1)}),12e3);this.myBulletQuantityTimer.push(e)}this.sounds.bulletQuantity.play(),this.supplys1.killAndHide(t)}else"bombSupply"==t.name&&(this.enemyPlanes1.getChildren().forEach((e=>{e.active&&(e.hp=0,e.anims.play("smallPlaneBoom"),e.setVelocity(0,0),setTimeout((()=>{this.enemyPlanes1.killAndHide(e)}),180),this.score+=10,this.scoreText.setText("Score: "+this.score))})),this.enemyPlanes2.getChildren().forEach((e=>{e.active&&(e.hp=0,e.anims.play("midPlaneBoom"),e.setVelocity(0,0),setTimeout((()=>{this.enemyPlanes2.killAndHide(e)}),180),this.score+=10,this.scoreText.setText("Score: "+this.score))})),this.enemyPlanes3.getChildren().forEach((e=>{e.active&&(e.hp=0,e.anims.play("bigPlaneBoom"),e.setVelocity(0,0),setTimeout((()=>{this.enemyPlanes3.killAndHide(e)}),180),this.score+=10,this.scoreText.setText("Score: "+this.score))})),this.sounds.bigboom.play(),this.supplys2.killAndHide(t))}}const a={type:Phaser.AUTO,width:e,height:t,antialias:!0,zoom:.99999999,resolution:s||1,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[i,l],audio:{disableWebAudio:!1}},n=new Phaser.Game(a)})();